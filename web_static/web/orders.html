<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Didle - Orders</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/css/header.css">
    <link rel="icon" type="image/x-icon" href="static/img/favicon.ico">
    <style>
        .card-header {
            background-color: #4677EA; /* 헤더 배경색 변경 */
            color: #fff; /* 텍스트 흰색 */
        }

        .card-title {
            color: #4677EA; /* 제목 색상 변경 */
        }

        .card-text {
            margin-bottom: 0.5rem;
        }

        .list-group-item {
            border: none; /* 리스트 항목 테두리 제거 */
        }

        .list-group-item:not(:last-child) {
            border-bottom: 1px solid #ddd; /* 리스트 항목 구분선 */
        }

    </style>
</head>
<body>
<header>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <!-- Brand 경로 확인 -->
            <a class="navbar-brand d-flex align-items-center" href="/">
                <img src="./static/img/logo.png" alt="Logo"> <!-- 로고 경로 확인 -->
            </a>

            <!-- Toggle button for mobile -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Collapsible content -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Navigation Links 경로 확인 -->
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="index.html/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>
                    <li class="nav-item"><a class="nav-link" href="cart.html">Cart</a></li>
                    <li class="nav-item"><a class="nav-link" href="orders.html">Orders</a></li>
                </ul>

                <!-- Auth Section - JavaScript로 동적 제어 -->
                <div id="auth-section" class="auth-buttons d-flex align-items-center">
                    <!-- 로그인 상태 영역 (초기 숨김) -->
                    <div id="logged-in-user" style="display: none;" class="align-items-center">
                        <span id="user-greeting" class="me-3"></span>
                        <div id="admin-link-container" style="display: none;">
                            <a href="a_user.html" class="btn btn-outline-danger btn-sm">관리자 페이지</a>
                        </div>
                        <button onclick="logout()" class="btn btn-outline-dark btn-sm">Logout</button>
                    </div>

                    <!-- 비로그인 상태 영역 (초기 표시) -->
                    <div id="guest-user" style="display: block;">
                        <a href="login.html" class="btn btn-primary btn-sm">Login</a>
                        <a href="signup.html" class="btn btn-success btn-sm">Sign Up</a>
                    </div>
                </div>
            </div> <!-- End of collapsible content -->
        </div> <!-- End of container-fluid -->
    </nav> <!-- End of Navbar -->
</header>

<div class="container">
    <h2 class="mt-4">Order History</h2>
    <div id="order-list">
        <!-- Order items will be displayed here -->
    </div>
</div>

<script>
    function loadOrders() {
        const userId = /*[[${session.userId}]]*/ null;

        // 로그인 여부 확인
        if (!userId) {
            alert('Please login to view your orders');
            window.location.href = '/login';
            return; // 로그인되지 않은 경우 함수 종료
        }

        // Fetch orders for the user
        fetch(`/api/orders/user/${userId}`)
            .then(response => response.json())
            .then(orders => {
                const orderList = document.getElementById('order-list');
                orderList.innerHTML = ''; // Clear previous order list

                if (orders.length === 0) {
                    // 주문이 없을 경우 메시지 표시
                    orderList.innerHTML = '<p class="text-center text-primary mt-4">No orders found!</p>';
                    return;
                }

                // 주문 목록 렌더링
                orders.forEach(order => {
                    const orderElement = document.createElement('div');
                    orderElement.className = 'card mb-3 shadow-sm'; // Bootstrap 카드 스타일 추가
                    let orderItemsHtml = '';
                    order.orderItems.forEach(item => {
                        orderItemsHtml += `<li class="list-group-item">${item.productName} - Quantity: ${item.quantity}, Price: $${item.price}</li>`;
                    });

                    orderElement.innerHTML = `
                    <div class="card-header bg-primary text-white">
                        Order #${order.id}
                    </div>
                    <div class="card-body">
                        <p><strong>Date:</strong> ${new Date(order.createdAt).toLocaleDateString()}</p>
                        <p><strong>Status:</strong> ${order.status}</p>
                        <p><strong>Total:</strong> $${order.totalPrice}</p>
                        <h6>Items:</h6>
                        <ul class="list-group list-group-flush">
                            ${orderItemsHtml}
                        </ul>
                    </div>
                `;
                    orderList.appendChild(orderElement);
                });
            })
            .catch(error => console.error('Error fetching orders:', error));
    }


    // Load orders when the page loads
    document.addEventListener('DOMContentLoaded', loadOrders);
</script>
<script src="static/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
